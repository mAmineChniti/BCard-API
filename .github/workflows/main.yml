name: CI/CD for FastAPI API

on:
  push:
    branches:
      - master

jobs:
  deploy:
    name: Deploy FastAPI API
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.11.4'  # Replace 'x' with the appropriate version of Python

      - name: Install dependencies
        run: pip install --upgrade pip && pip install -r requirements.txt

      - name: Deploy with Uvicorn
        env:
          USER: ${{ env.USER }}
          PASS: ${{ env.PASS }}
          BASE: ${{ env.BASE }}
          COLLECTION: ${{ env.COLLECTION }}
          REDUSER: ${{ env.REDUSER }}
          REDPASSWORD: ${{ env.REDPASSWORD }}
          REDHOSTNAME: ${{ env.REDHOSTNAME }}
          REDPORT: ${{ env.REDPORT }}
          HOST: ${{ env.HOST }}
        run: uvicorn BCard:app --host 0.0.0.0 --port 8000
